<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Browser Utils</title>
    <link rel="stylesheet" href="popup.css">
  </head>
  <body class="no-js">
    <div class="app-shell">
      <main class="content">
        <header class="content-header">
          <div class="title-block">
            <div class="hero-logo-wrap" aria-hidden="true">
              <img src="images/logo.png" alt="" class="hero-logo">
            </div>
            <div class="title-text">
              <div class="title-row">
                <h1>ブラウザ作業を整える相棒</h1>
              </div>
            </div>
          </div>
          <button type="button" class="cta-pill" id="cta-pill" hidden></button>
        </header>

        <div class="content-body">
          <section class="pane active" id="pane-actions" role="tabpanel" aria-label="アクション">
            <div class="pane-intro">
              <div>
                <p class="pane-eyebrow">Context Actions</p>
                <h2>選択テキストを起点にアクション実行</h2>
                <p class="muted">選択テキスト（なければ本文）を入力に、アクションを実行します。</p>
                <div class="action-row">
                  <button id="copy-action-output" class="btn btn-ghost" disabled>コピー</button>
                  <button id="open-calendar" class="btn btn-ghost" hidden>Googleカレンダー</button>
                  <button id="download-ics" class="btn btn-ghost" hidden>.ics</button>
                </div>
              </div>
            </div>

            <div class="card-grid">
              <div class="card">
                <div class="card-header">
                  <div>
                    <p class="card-eyebrow">Actions</p>
                    <h3>アクション一覧</h3>
                  </div>
                  <span class="chip chip-soft" id="action-source-chip">-</span>
                </div>
                <div id="action-buttons" class="action-buttons" aria-label="アクションボタン一覧"></div>
                <p class="hint">
                  変数: <code>{{text}}</code>
                  <code>{{title}}</code>
                  <code>{{url}}</code>
                  <code>{{source}}</code>
                </p>
              </div>

              <div class="card secondary">
                <div class="card-header">
                  <div>
                    <p class="card-eyebrow">Register</p>
                    <h3>タイトルとプロンプトを登録</h3>
                  </div>
                  <span class="chip chip-soft">任意</span>
                </div>
                <label class="field-label" for="action-title">タイトル</label>
                <input type="text" id="action-title" class="token-input" placeholder="例: 日本語に翻訳">
                <label class="field-label" for="action-kind">種類</label>
                <select id="action-kind" class="token-input" aria-label="アクション種類">
                  <option value="text" selected>テキスト生成</option>
                  <option value="event">カレンダー登録（イベント抽出）</option>
                </select>
                <label class="field-label" for="action-prompt">プロンプト</label>
                <textarea
                  id="action-prompt"
                  class="prompt-input"
                  placeholder="例: 次のテキストを日本語に翻訳してください。\n\n{{text}}"
                ></textarea>
                <div class="token-row token-row-actions">
                  <button id="save-action" class="btn btn-primary">保存</button>
                  <button id="clear-action" class="btn btn-ghost">クリア</button>
                  <button id="reset-actions" class="btn btn-ghost">リセット</button>
                </div>
                <div id="action-list" class="pattern-list" aria-live="polite"></div>
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <div>
                  <p class="card-eyebrow">Output</p>
                  <h3 id="action-output-title">結果</h3>
                </div>
              </div>
              <textarea
                id="action-output"
                class="summary-output"
                placeholder="ここに結果が表示されます"
                readonly
              ></textarea>
              <p class="hint">結果はコピーして貼り付けできます。</p>
            </div>
          </section>

          <section class="pane" id="pane-table" role="tabpanel" aria-label="テーブルソート">
            <div class="pane-intro">
              <div>
                <p class="pane-eyebrow">テーブルソート</p>
                <h2>いま開いているページの表に並び替えを付与</h2>
                <p class="muted">ヘッダーで昇順/降順。動的な表にも追従します。</p>
                <div class="action-row">
                  <button id="enable-table-sort" class="btn btn-primary">このタブで実行</button>
                  <label class="checkbox-inline">
                    <input type="checkbox" id="auto-enable-sort">
                    開いたら自動で有効化
                  </label>
                </div>
              </div>
            </div>

            <div class="card-grid">
              <div class="card">
                <div class="card-header">
                  <div>
                    <p class="card-eyebrow">URLパターン</p>
                    <h3>特定のページで自動化</h3>
                  </div>
                </div>
                <p class="card-copy">マッチしたページで自動ON。</p>

                <div class="pattern-input-group">
                  <input
                    type="text"
                    id="pattern-input"
                    placeholder="例: *.moneyforward.com/bs/*"
                    class="pattern-input"
                    aria-label="ドメインパターン"
                  >
                  <button id="add-pattern" class="btn btn-ghost">追加</button>
                </div>

                <div id="pattern-list" class="pattern-list" aria-live="polite"></div>
              </div>
            </div>
          </section>

          <section class="pane" id="pane-settings" role="tabpanel" aria-label="設定">
            <div class="pane-intro">
              <div>
                <p class="pane-eyebrow">設定</p>
                <h2>AI連携</h2>
                <p class="muted">出力スタイルと OpenAI Token を設定します。</p>
              </div>
            </div>

            <div class="card secondary">
              <div class="card-header">
                <div>
                  <p class="card-eyebrow">プロンプト</p>
                  <h3>AI出力の口調・特徴をカスタム</h3>
                </div>
                <span class="chip chip-soft">任意</span>
              </div>
              <label class="field-label" for="openai-custom-prompt">カスタムプロンプト</label>
              <textarea
                id="openai-custom-prompt"
                class="prompt-input"
                placeholder="例: です/ます調。箇条書きは短く。技術用語は補足を付けて。"
              ></textarea>
              <div class="token-row token-row-actions">
                <button id="save-openai-custom-prompt" class="btn btn-primary">保存</button>
                <button id="clear-openai-custom-prompt" class="btn btn-ghost">クリア</button>
              </div>
              <p class="hint">要約の口調に反映されます。</p>
            </div>

            <div class="card">
              <div class="card-header">
                <div>
                  <p class="card-eyebrow">APIキー</p>
                  <h3>OpenAI API Tokenを入力</h3>
                </div>
                <span class="chip chip-soft">必須</span>
              </div>

              <label class="field-label" for="openai-token">OpenAI API Token</label>
              <div class="token-row token-row-main">
                <input type="password" id="openai-token" placeholder="sk-..." class="token-input" autocomplete="off">
                <button id="toggle-openai-token-visibility" class="btn btn-ghost" aria-label="トークンの表示切り替え">
                  表示
                </button>
              </div>
              <div class="token-row token-row-actions">
                <button id="save-openai-token" class="btn btn-primary">保存</button>
                <button id="test-openai-token" class="btn btn-ghost">動作確認</button>
                <button id="clear-openai-token" class="btn btn-ghost">クリア</button>
              </div>
            </div>
          </section>
        </div>
      </main>

      <div class="menu-scrim" id="menu-scrim" aria-hidden="true"></div>
      <aside class="menu-drawer" id="menu-drawer" aria-label="メニュー" aria-hidden="true">
        <div class="menu-drawer-header">
          <p class="menu-drawer-title">メニュー</p>
          <button type="button" class="menu-close" id="menu-close" aria-label="閉じる" title="閉じる">
            <span aria-hidden="true">
              <svg viewBox="0 0 24 24" role="img" focusable="false">
                <path d="M6 6l12 12"/>
                <path d="M18 6 6 18"/>
              </svg>
            </span>
          </button>
        </div>
        <nav class="menu-drawer-nav" aria-label="ページ">
          <a class="menu-item" data-target="pane-actions" href="#pane-actions" aria-label="アクション">
            <span class="menu-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" role="img" focusable="false">
                <path d="M13 2 3 14h7l-1 8 12-14h-7l-1-6Z"/>
              </svg>
            </span>
            <span class="menu-text">アクション</span>
          </a>
          <a class="menu-item" data-target="pane-table" href="#pane-table" aria-label="テーブルソート">
            <span class="menu-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" role="img" focusable="false">
                <path d="M8 6h10"/>
                <path d="M8 12h10"/>
                <path d="M8 18h10"/>
                <path d="M6 8 4 6 2 8"/>
                <path d="M4 6v12"/>
                <path d="M2 16l2 2 2-2"/>
              </svg>
            </span>
            <span class="menu-text">テーブルソート</span>
          </a>
          <div class="menu-spacer" aria-hidden="true"></div>
          <a class="menu-item" data-target="pane-settings" href="#pane-settings" aria-label="設定">
            <span class="menu-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" role="img" focusable="false">
                <path
                  d="M12 2l1 2a7.9 7.9 0 0 1 2 1l2-1 2 4-2 1a7.9 7.9 0 0 1 0 2l2 1-2 4-2-1a7.9 7.9 0 0 1-2 1l-1 2h-4l-1-2a7.9 7.9 0 0 1-2-1l-2 1-2-4 2-1a7.9 7.9 0 0 1 0-2L1 8l2-4 2 1a7.9 7.9 0 0 1 2-1l1-2h4Z"
                />
                <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/>
              </svg>
            </span>
            <span class="menu-text">設定</span>
          </a>
        </nav>
      </aside>

      <aside class="sidebar" aria-label="メニュー">
        <button
          type="button"
          class="sidebar-brand sidebar-toggle"
          id="sidebar-toggle"
          aria-label="メニューを切り替え"
          aria-pressed="false"
          title="メニュー"
          data-tooltip="メニュー"
        >
          <svg viewBox="0 0 24 24" role="img" focusable="false" aria-hidden="true">
            <path d="M4 7h16"/>
            <path d="M4 12h16"/>
            <path d="M4 17h16"/>
          </svg>
        </button>
        <a
          class="nav-item active"
          data-target="pane-actions"
          href="#pane-actions"
          role="tab"
          aria-controls="pane-actions"
          aria-label="アクション"
          title="アクション"
          data-tooltip="アクション"
        >
          <span class="nav-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" role="img" focusable="false">
              <path d="M13 2 3 14h7l-1 8 12-14h-7l-1-6Z"/>
            </svg>
          </span>
          <span class="nav-label">アクション</span>
        </a>
        <a
          class="nav-item"
          data-target="pane-table"
          href="#pane-table"
          role="tab"
          aria-controls="pane-table"
          aria-label="テーブルソート"
          title="テーブル"
          data-tooltip="テーブル"
        >
          <span class="nav-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" role="img" focusable="false">
              <path d="M8 6h10"/>
              <path d="M8 12h10"/>
              <path d="M8 18h10"/>
              <path d="M6 8 4 6 2 8"/>
              <path d="M4 6v12"/>
              <path d="M2 16l2 2 2-2"/>
            </svg>
          </span>
          <span class="nav-label">テーブル</span>
        </a>
        <a
          class="nav-item"
          data-target="pane-settings"
          href="#pane-settings"
          role="tab"
          aria-controls="pane-settings"
          aria-label="設定"
          title="設定"
          data-tooltip="設定"
        >
          <span class="nav-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" role="img" focusable="false">
              <path
                d="M12 2l1 2a7.9 7.9 0 0 1 2 1l2-1 2 4-2 1a7.9 7.9 0 0 1 0 2l2 1-2 4-2-1a7.9 7.9 0 0 1-2 1l-1 2h-4l-1-2a7.9 7.9 0 0 1-2-1l-2 1-2-4 2-1a7.9 7.9 0 0 1 0-2L1 8l2-4 2 1a7.9 7.9 0 0 1 2-1l1-2h4Z"
              />
              <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/>
            </svg>
          </span>
          <span class="nav-label">設定</span>
        </a>
      </aside>
    </div>

    <script src="popup_bootstrap.js"></script>
  </body>
</html>
